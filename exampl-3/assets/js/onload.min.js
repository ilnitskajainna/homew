const API_KEY="6c2f978356ec0ddc45cecbee3ebf1d7c",OMDB_KEY="621d1d15";function selectChanged(){let sel;"OMDB"==$("#service").val()?$("#type").show():$("#type").hide()}function search($btn){selectChanged(),"OMDB"==$("#service").val()?searchOMDB($btn):searchFilms($btn)}function searchOMDB($btn){$btn.hasClass("disabled")||($btn.addClass("disabled"),$.ajax({url:"http://www.omdbapi.com/?apikey=621d1d15&s="+$("#search").val()+"&type="+$("#type").val(),type:"get",dataType:"json",success:function(json){let rez="",item;if(0!=json.Search.length)for(let i=0;i<json.Search.length;i++)item=json.Search[i],image=item.hasOwnProperty("Poster")?item.Poster:"https://via.placeholder.com/200x300.png?text=No poster",rez+=`\n                        <div class="film_item">\n                            <div class="film_poster">\n                                <img src="${image}" alt="${item.Title}">\n                            </div>\n                            <div class="film_info">\n                                <h4>${item.Title}</h4>\n                                <div><b>Year:</b>${item.Year}</div>\n                                <div class="btn_wrap">\n                                    <a href="javascript:void(0)" data-id="${item.imdbID}" onclick="getDetail($(this))" class="btn">Detail info</a>\n                                </div>\n                            </div>\n                            <div class="film_detail"></div>\n                        </div>\n                        `;else rez='<p style="text-aligen:center">Nothing found</p>';$("#search_result").html(rez),$btn.removeClass("disabled")},error:function(err){alert(err.status),$btn.removeClass("disabled")}}))}function getDetail($lnk){$(".film_detail").hide(),$lnk.hasClass("done")?$lnk.parents(".film_item").find(".film_detail").show():$lnk.hasClass("disabled")||($lnk.addClass("disabled"),$.ajax({url:"http://www.omdbapi.com/?apikey=621d1d15&i="+$lnk.data("id"),type:"get",dataType:"json",success:function(json){let rez=`\n                        <ul>\n                            <li><b>Release data:</b> ${json.Released}</li>\n                            <li><b>Rating:</b> ${json.imdbRating}</li>\n                            <li><b>Runtime:</b> ${json.Runtime}</li>\n                            <li><b>Plot:</b> ${json.Plot}</li>`;rez+="</ul>",$lnk.parents(".film_item").find(".film_detail").html(rez),$lnk.parents(".film_item").find(".film_detail").show(),$lnk.removeClass("disabled"),$lnk.addClass("done")},error:function(err){alert(err.status),$lnk.removeClass("disabled")}}))}function searchFilms($btn){$btn.hasClass("disabled")||($btn.addClass("disabled"),$.ajax({url:"https://api.themoviedb.org/3/search/movie?api_key="+API_KEY+"&query="+$("#search").val(),type:"get",dataType:"json",success:function(json){let rez="",image="",item;if(0!=json.results.length){for(let i=0;i<json.results.length;i++)item=json.results[i],image=null!=item.poster_path?"https://image.tmdb.org/t/p/w500"+item.poster_path:"https://via.placeholder.com/200x300.png?text=No postetr",rez+=`\n                        <div class="film_item">\n                            <div class="film_poster">\n                                <img src="${image}" alt="${item.original_title}">\n                            </div>\n                            <div class="film_info">\n                                <h3>${item.title}</h3>\n                                <div><b>Release data:</b> ${item.release_date}</div>\n                                <div><b>Rating:</b> ${item.vote_average}</div>\n                                <div> ${item.overview}</div>\n                                <div class="btn_wrap">\n                                    <a href="javascript:void(0)" data-id="${item.id}" onclick="getDetailInfo($(this))" class="btn">Detail info</a>\n                                </div>\n                            </div>\n                            <div class="film_detail"></div>\n                        </div>\n                        `;buildPagination(json.page,json.total_pages,json.total_results)}else rez='<p style="text-aligen:center">Nothing found</p>';$("#search_result").html(rez),$btn.removeClass("disabled")},error:function(err){alert(err.status),$btn.removeClass("disabled")},error:function(err){alert(err.status),$lnk.removeClass("disabled")}}))}function getDetailInfo($lnk){$(".film_detail").hide(),$lnk.hasClass("done")?$lnk.parents(".film_item").find(".film_detail").show():$lnk.hasClass("disabled")||($lnk.addClass("disabled"),$.ajax({url:"https://api.themoviedb.org/3/movie/"+$lnk.data("id")+"?api_key="+API_KEY,type:"get",dataType:"json",success:function(json){let clist="";for(let c in json.production_countries)clist+=`<li>${json.production_countries[c].name}</li>`;let rez=`\n                        <ul>\n                            <li><b>Popuarity rate:</b> ${json.popularity}</li>\n                            <li><b>Homepage:</b> <a href="${json.homepage}" target="blank">go to homepage</a></li>\n                            <li><b>Slogan:</b> ${json.tagline}</li>\n                            <li><b>Time:</b> ${json.runtime}</li>\n                            <li><b>Status:</b> ${json.status}</li>`;0!=json.production_countries.length&&(rez+=`<li><b>Countries:</b>\n                                <ul> ${clist}</ul>\n                            </li>`),rez+="</ul>",$lnk.parents(".film_item").find(".film_detail").html(rez),$lnk.parents(".film_item").find(".film_detail").show(),$lnk.removeClass("disabled"),$lnk.addClass("done")},error:function(err){alert(err.status),$lnk.removeClass("disabled")}}))}